{"version":3,"sources":["file:///C:/PROJECT/COCOS/SRC/2025/BLOCK_PUZZLE_SAGA/assets/script/rootScene.ts"],"names":["TWebGameClass","_decorator","Component","game","WebView","TGameClass","TPreloadSceneClass","TGameDataClass","TMainSceneClass","ccclass","property","rootScene","webGame","start","node","webView","setJavascriptInterfaceScheme","gameData","WEBVIEW_SCHEME","setOnJSCallback","target","url","console","log","str","replace","atob","jsonStr","command","data","JSON","parse","mainScene","onWebViewCommand","error","toString","update","deltaTime","loop","pause","constructor","root","gameImageLists","preloadScene","removeFromParent","Map","sceneManager","addScene","setCurrentScene"],"mappings":"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","sourcesContent":["import { _decorator, Component, game, Node, SpriteFrame, WebView } from 'cc';\r\nimport { ADDGAME, MYGAME, TGameClass } from './utils';\r\nimport { TPreloadSceneClass } from './preloadSceneClass';\r\nimport { TGameDataClass } from './gameDataClass';\r\nimport { TMainSceneClass } from './mainSceneClass';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('rootScene')\r\nexport class rootScene extends Component {\r\n    @property(WebView)\r\n    public webView: WebView;\r\n    webGame: TWebGameClass;\r\n    start() {\r\n        this.webGame = new TWebGameClass(this.node, this.webView);\r\n        this.webView.setJavascriptInterfaceScheme(this.webGame.gameData.WEBVIEW_SCHEME);\r\n        //@ts-ignore\r\n        this.webView.setOnJSCallback((target, url) => {\r\n            console.log(url);\r\n            console.log('setOnJSCallback url :', url)\r\n            let str = url.replace(this.webGame.gameData.WEBVIEW_SCHEME + '://', ''); // str === 'a=1&b=2'\r\n            str = atob(str);\r\n            console.log('setOnJSCallback str :', str);\r\n            let jsonStr;\r\n            let command;\r\n            let data;\r\n            try {\r\n                jsonStr = JSON.parse(str);\r\n                command = jsonStr.command;\r\n                data = JSON.parse(jsonStr.data);\r\n                this.webGame.mainScene.onWebViewCommand(command, data);\r\n            } catch (error) {\r\n                console.log(error.toString());\r\n            }\r\n        });\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        try {\r\n            this.webGame.loop(deltaTime);\r\n        } catch (error) {\r\n            console.log(error);\r\n            game.pause();\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class TWebGameClass extends TGameClass {\r\n    gameImageLists: Map<string, SpriteFrame>\r\n    gameData: TGameDataClass;\r\n    preloadScene: TPreloadSceneClass;\r\n    mainScene: TMainSceneClass;\r\n    webView: WebView;\r\n    constructor(root: Node, webView: WebView) {\r\n        super(root);\r\n        this.webView = webView;\r\n        this.webView.node.removeFromParent();\r\n        this.gameImageLists = new Map();\r\n        this.gameData = new TGameDataClass(this);\r\n\r\n        this.preloadScene = new TPreloadSceneClass(this.root, this.sceneManager, this);\r\n        this.mainScene = new TMainSceneClass(this.root, this.sceneManager, this);\r\n        this.sceneManager.addScene('PRELOAD', this.preloadScene);\r\n        this.sceneManager.addScene('MAIN_SCENE', this.mainScene);\r\n        this.sceneManager.setCurrentScene('PRELOAD');\r\n    }\r\n\r\n    loop(deltaTime: number) {\r\n        this.sceneManager.loop(deltaTime);\r\n    }\r\n}"]}